this.qst=this.qst||{},this.qst.Templates=this.qst.Templates||{},this.qst.Templates.ptemplates=this.qst.Templates.ptemplates||{},this.qst.Templates.ptemplates["blocks/item-receipt"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f,i="";return i+="\n				",f={hash:{},inverse:p.program(4,h,b),fn:p.program(2,g,b),data:b},d=c.ifEq||a.ifEq,e=d?d.call(a,a.external,"0",f):o.call(a,"ifEq",a.external,"0",f),(e||0===e)&&(i+=e),i+="\n			"}function g(a,b){var d,e,f="";return f+='\n					<span class="receipt__form__buy-btn"><a class="receipt__form__buy-btn-in" href="',(d=c.url)?d=d.call(a,{hash:{},data:b}):(d=a.url,d=typeof d===m?d.apply(a):d),f+=n(d)+'" target="_blank">',e={hash:{},data:b},f+=n((d=c._||a._,d?d.call(a,"Get file","itemreceipt",e):o.call(a,"_","Get file","itemreceipt",e)))+"</a></span>\n				"}function h(a,b){var d,e,f="";return f+='\n					<span class="receipt__form__buy-btn"><a class="receipt__form__buy-btn-in" href="',(d=c.url)?d=d.call(a,{hash:{},data:b}):(d=a.url,d=typeof d===m?d.apply(a):d),f+=n(d)+'" target="_blank">',e={hash:{},data:b},f+=n((d=c._||a._,d?d.call(a,"Get link","itemreceipt",e):o.call(a,"_","Get link","itemreceipt",e)))+"</a></span>\n				"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k,l="",m="function",n=this.escapeExpression,o=c.helperMissing,p=this;return l+='<div class="receipt__form-add-comment">\n	<i class="is is-com receipt__form-add-comment__icn"></i>\n	<ul class="receipt__form-add-comment__list">\n		<li class="receipt__form-add-comment__add"><a href="add" rel="nofollow" class="receipt__form-add-comment-a">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Add your<br/>message on the receipt","itemreceipt",k):o.call(b,"_","Add your<br/>message on the receipt","itemreceipt",k)))+'</a></li>\n		<li class="receipt__form-add-comment__edit"><a href="edit" rel="nofollow" class="receipt__form-add-comment-a">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Edit your message on the receipt","itemreceipt",k):o.call(b,"_","Edit your message on the receipt","itemreceipt",k)))+'</a></li>\n	</ul>\n</div>\n<div class="receipt__cont">\n	<div class="receipt__form-t"></div>\n	<div class="receipt__form">\n		<div class="receipt__form-col">\n			<span class="receipt__form-line">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Purchased","itemreceipt",k):o.call(b,"_","Purchased","itemreceipt",k)))+'</span>\n			<span class="receipt__form-price"><span class="receipt__form-price-val">',k={hash:{},data:e},l+=n((i=c._number_format||b._number_format,i?i.call(b,b.price,k):o.call(b,"_number_format",b.price,k)))+"</span>",k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,b.currency,"currency",k):o.call(b,"_",b.currency,"currency",k)))+'</span>\n			<h1 class="receipt__form-h"><a href="',(j=c.url_short)?j=j.call(b,{hash:{},data:e}):(j=b.url_short,j=typeof j===m?j.apply(b):j),l+=n(j)+'" target="_blank">',(j=c.name)?j=j.call(b,{hash:{},data:e}):(j=b.name,j=typeof j===m?j.apply(b):j),l+=n(j)+"</a></h1>\n			",j=c["if"].call(b,b.url,{hash:{},inverse:p.noop,fn:p.program(1,f,e),data:e}),(j||0===j)&&(l+=j),l+='\n			<div class="receipt__form-receipt_desc-group qst__inp-group">\n				<div class="receipt__form-receipt_desc-cont qst__inp-cont">\n					<textarea value="" class="receipt__form-receipt_desc qst__inp" name="receipt_comment">',(j=c.receipt_comment)?j=j.call(b,{hash:{},data:e}):(j=b.receipt_comment,j=typeof j===m?j.apply(b):j),l+=n(j)+'</textarea>\n				</div>\n				<ul class="receipt__form-receipt_desc-action-list"><li class="receipt__form-receipt_desc-action receipt__form-receipt_desc-action_cancel"><a href="receipt-cancel" rel="nofollow" class="receipt__form-receipt_desc-action-a">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Cancel","itemreceipt",k):o.call(b,"_","Cancel","itemreceipt",k)))+'</a></li><li class="receipt__form-receipt_desc-action receipt__form-receipt_desc-action_save"><a href="receipt-save" rel="nofollow" class="receipt__form-receipt_desc-action-a">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Save","itemreceipt",k):o.call(b,"_","Save","itemreceipt",k)))+'</a></li>\n				</ul>\n			</div>\n			<p class="receipt__form-desc">',(j=c.receipt_comment)?j=j.call(b,{hash:{},data:e}):(j=b.receipt_comment,j=typeof j===m?j.apply(b):j),l+=n(j)+'</p>\n			<p class="receipt__form-desc-static">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"All purchasement info we&#39;ve sent to your email","itemreceipt",k):o.call(b,"_","All purchasement info we&#39;ve sent to your email","itemreceipt",k)))+'</p>\n			<ul class="receipt__share">\n				<li class="receipt__share-itm receipt__share-itm-title">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Share","itemreceipt",k):o.call(b,"_","Share","itemreceipt",k)))+'</li>\n				<li class="receipt__share-itm"><a class="receipt__share-itm-a" rel="nofollow" href="vk"><i class="is is-shc-vk"></i></a></li>\n				<li class="receipt__share-itm"><a class="receipt__share-itm-a" rel="nofollow" href="facebook"><i class="is is-shc-fb"></i></a></li>\n				<li class="receipt__share-itm"><a class="receipt__share-itm-a" rel="nofollow" href="twitter"><i class="is is-shc-tw"></i></a></li>\n			</ul>\n		</div>\n		<div class="receipt__service-desc"><a href="http://qstoq.ru" target="_blank">Qstoq</a> &mdash; ',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"selling in lightning speed","itemreceipt",k):o.call(b,"_","selling in lightning speed","itemreceipt",k)))+'</div>\n	</div>\n	<div class="receipt__form-b"></div>\n</div>'}),this.qst.Templates.ptemplates["blocks/item"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n						<div class="showcase__form__img-cont load-bg">\n							<img src="',(d=c._empty_img)?d=d.call(a,{hash:{},data:b}):(d=a._empty_img,d=typeof d===m?d.apply(a):d),e+=n(d)+'" alt="" class="showcase__form__img lazy" data-orig="'+n((d=a.preview_obj,d=null==d||d===!1?d:d.data,typeof d===m?d.apply(a):d))+'">\n						</div>\n						'}function g(a,b){var d,e="";return e+='<pre class="showcase__form-desc" itemprop="description">',(d=c.description)?d=d.call(a,{hash:{},data:b}):(d=a.description,d=typeof d===m?d.apply(a):d),e+=n(d)+"</pre>"}function h(a,b){var c,d="";return d+='<span class="hidden showcase__form-image" itemprop="image">'+n((c=a.preview_obj,c=null==c||c===!1?c:c.data,typeof c===m?c.apply(a):c))+"</span>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k,l="",m="function",n=this.escapeExpression,o=this,p=c.helperMissing;return l+='<table class="showcase__table" itemscope itemtype="http://schema.org/Product">\n	<tr>\n		<td>\n			<div class="showcase__cont">\n				<div class="showcase__form">\n					<div class="showcase__form__col1">\n						',i=c["if"].call(b,b.preview_obj,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(i||0===i)&&(l+=i),l+='\n						<h1 class="showcase__form-h" itemprop="name">',(i=c.name)?i=i.call(b,{hash:{},data:e}):(i=b.name,i=typeof i===m?i.apply(b):i),l+=n(i)+"</h1>\n						",i=c["if"].call(b,b.description,{hash:{},inverse:o.noop,fn:o.program(3,g,e),data:e}),(i||0===i)&&(l+=i),l+="\n						",i=c["if"].call(b,b.preview_obj,{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(i||0===i)&&(l+=i),l+='\n						<span class="hidden showcase__form-url" itemprop="url">',(i=c.url_short)?i=i.call(b,{hash:{},data:e}):(i=b.url_short,i=typeof i===m?i.apply(b):i),l+=n(i)+'</span>\n						<ul class="showcase__share">\n							<li class="showcase__share-itm">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Share","item",k):p.call(b,"_","Share","item",k)))+'</li>\n							<li class="showcase__share-itm"><a class="showcase__share-itm-a" href="vk"><i class="is is-shc-vk"></i></a></li>\n							<li class="showcase__share-itm"><a class="showcase__share-itm-a" href="facebook"><i class="is is-shc-fb"></i></a></li>\n							<li class="showcase__share-itm"><a class="showcase__share-itm-a" href="twitter"><i class="is is-shc-tw"></i></a></li>\n						</ul>\n					</div>\n					<div class="showcase__form__col2" itemprop="offers" itemscope itemtype="http://schema.org/Offer">\n						<span class="showcase__form-price"><span class="showcase__form-price-val">',k={hash:{},data:e},l+=n((i=c._number_format||b._number_format,i?i.call(b,b.price,k):p.call(b,"_number_format",b.price,k)))+"</span>",k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,b.currency,"currency",k):p.call(b,"_",b.currency,"currency",k)))+'</span>\n						<span class="hidden showcase__form-price" itemprop="price">',(j=c.price)?j=j.call(b,{hash:{},data:e}):(j=b.price,j=typeof j===m?j.apply(b):j),l+=n(j)+" ",k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,b.currency,"currency",k):p.call(b,"_",b.currency,"currency",k)))+'</span>\n						<form action="purchase" method="post">\n							<div class="showcase__form-email-group qst__inp-group">\n								<div class="showcase__form-email-cont qst__inp-cont">\n									<input type="text" value="',(j=c.customer_email)?j=j.call(b,{hash:{},data:e}):(j=b.customer_email,j=typeof j===m?j.apply(b):j),l+=n(j)+'" placeholder="',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"email","itemedit",k):p.call(b,"_","email","itemedit",k)))+'" class="showcase__form-email qst__inp" name="customer_email" maxlength="50">\n								</div>\n							</div>\n							<input type="submit" class="hidden-submit">\n						</form>\n						<p class="showcase__form-price-desc">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"for notifications about your purchases<br/>and feedback","itemedit",k):p.call(b,"_","for notifications about your purchases<br/>and feedback","itemedit",k)))+'</p>\n\n						<a class="showcase__form__buy-btn" href="purchase"><span class="showcase__form__buy-btn-in">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Buy","itemedit",k):p.call(b,"_","Buy","itemedit",k)))+'</span></a>\n						<span class="item__error"></span>\n					</div>\n					<div class="showcase__form__bottom-row">\n						<div class="showcase__form__bottom-row__col1"><a href="http://qstoq.ru" target="_blank">Qstoq</a> &mdash; ',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"selling in lightning speed","itemedit",k):p.call(b,"_","selling in lightning speed","itemedit",k)))+'</div>\n						<div class="showcase__form__bottom-row__col2"><i class="is is-lock showcase__form__safe-icn"></i><span class="showcase__form__safe-desc">',k={hash:{},data:e},l+=n((i=c._||b._,i?i.call(b,"Safe payment","item",k):p.call(b,"_","Safe payment","item",k)))+'</span></div>\n					</div>\n					<div class="showcase__form__blocker"></div>\n				</div>\n			</div>\n		</td>\n	</tr>\n</table>'}),this.qst.Templates.ptemplates["blocks/purchase"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f,i="";return i+='\n			<div class="purchase__col1">\n				<h1 class="purchase__h">',f={hash:{},data:b},i+=t((d=c._||a._,d?d.call(a,"Choose a payment method","purchase",f):v.call(a,"_","Choose a payment method","purchase",f)))+'</h1>\n				<ul class="purchase__category-list">\n				',e=c.each.call(a,(d=a.invoice,null==d||d===!1?d:d.pay_categories),{hash:{},inverse:u.noop,fn:u.program(2,g,b),data:b}),(e||0===e)&&(i+=e),i+='\n				</ul>\n			</div>\n			<div class="purchase__col2">\n				',e=c.each.call(a,(d=a.invoice,null==d||d===!1?d:d.pay_categories),{hash:{},inverse:u.noop,fn:u.program(4,h,b),data:b}),(e||0===e)&&(i+=e),i+="\n			</div>\n		"}function g(a,b){var d,e="";return e+='\n					<li class="purchase__category-item"><span class="purchase__category-item-a" href="',(d=c.id)?d=d.call(a,{hash:{},data:b}):(d=a.id,d=typeof d===s?d.apply(a):d),e+=t(d)+'"><i class="pc pc-',(d=c.id)?d=d.call(a,{hash:{},data:b}):(d=a.id,d=typeof d===s?d.apply(a):d),e+=t(d)+'"></i><span class="purchase__category-item-title">',(d=c.name)?d=d.call(a,{hash:{},data:b}):(d=a.name,d=typeof d===s?d.apply(a):d),e+=t(d)+"</span></span></li>\n				"}function h(a,b){var d,e="";return e+='\n				<ul class="purchase__method-list purchase__method-list-',(d=c.id)?d=d.call(a,{hash:{},data:b}):(d=a.id,d=typeof d===s?d.apply(a):d),e+=t(d)+'">\n					',d=c.each.call(a,a.methods,{hash:{},inverse:u.noop,fn:u.program(5,i,b),data:b}),(d||0===d)&&(e+=d),e+="\n				</ul>\n				"}function i(a,b){var d,e="";return e+='\n					<li class="purchase__method-item">\n						<span class="purchase__method-item-a" href="',(d=c.system_id)?d=d.call(a,{hash:{},data:b}):(d=a.system_id,d=typeof d===s?d.apply(a):d),e+=t(d)+'" rel="nofollow" data-methodid="',(d=c.method_id)?d=d.call(a,{hash:{},data:b}):(d=a.method_id,d=typeof d===s?d.apply(a):d),e+=t(d)+'" data-systemid="',(d=c.system_id)?d=d.call(a,{hash:{},data:b}):(d=a.system_id,d=typeof d===s?d.apply(a):d),e+=t(d)+'"',d=c["if"].call(a,a.params,{hash:{},inverse:u.noop,fn:u.program(6,j,b),data:b}),(d||0===d)&&(e+=d),e+='><i class="ps ps-',(d=c.method_id)?d=d.call(a,{hash:{},data:b}):(d=a.method_id,d=typeof d===s?d.apply(a):d),e+=t(d)+'"></i><span class="purchase__method-item-title"><span class="purchase__method-item-title-in">',(d=c.method_name)?d=d.call(a,{hash:{},data:b}):(d=a.method_name,d=typeof d===s?d.apply(a):d),e+=t(d)+"</span></span></span>\n						",d=c["if"].call(a,a.params,{hash:{},inverse:u.noop,fn:u.program(8,k,b),data:b}),(d||0===d)&&(e+=d),e+="\n					</li>\n					"}function j(a,b){return'  data-misc="1"'}function k(a,b){var d,e,f="";return f+='\n						<div class="purchase__method-item-misc">\n								',d=c.each.call(a,a.params,{hash:{},inverse:u.noop,fn:u.programWithDepth(9,l,b,a),data:b}),(d||0===d)&&(f+=d),f+='\n								<input type="submit" class="hidden-submit">\n								<div class="purchase__method-item-misc-submit">\n									<button type="submit" class="purchase__method-item-misc-submit-btn">',e={hash:{},data:b},f+=t((d=c._||a._,d?d.call(a,"Next","purchase",e):v.call(a,"_","Next","purchase",e)))+"</button>\n								</div>\n							</form>\n						</div>\n						"}function l(a,b,d){var e,f,g,h="";return h+='\n								<form action="." class="purchase__method-item-misc-form">\n									<div class="qst__inp-cont">\n										<label>\n											<span class="qst__lbl">',(e=c.label)?e=e.call(a,{hash:{},data:b}):(e=a.label,e=typeof e===s?e.apply(a):e),h+=t(e)+'</span>\n											<div class="qst__inp-cont-in',g={hash:{},inverse:u.noop,fn:u.program(10,m,b),data:b},e=c.ifEq||a.ifEq,f=e?e.call(a,a.type,"phone",g):v.call(a,"ifEq",a.type,"phone",g),(f||0===f)&&(h+=f),h+='">\n												<input type="text" data-type="',(f=c.type)?f=f.call(a,{hash:{},data:b}):(f=a.type,f=typeof f===s?f.apply(a):f),h+=t(f)+'" class="qst__inp" data-name="',(f=c.name)?f=f.call(a,{hash:{},data:b}):(f=a.name,f=typeof f===s?f.apply(a):f),h+=t(f)+'"',f=c["if"].call(a,a.length,{hash:{},inverse:u.noop,fn:u.program(12,n,b),data:b}),(f||0===f)&&(h+=f),h+=' name="'+t((e=d.system_id,typeof e===s?e.apply(a):e))+"_",(f=c.name)?f=f.call(a,{hash:{},data:b}):(f=a.name,f=typeof f===s?f.apply(a):f),h+=t(f)+'" value="">\n											</div>\n										</label>\n									</div>\n								'}function m(a,b){return" qst__inp_cont_phone"}function n(a,b){var d,e="";return e+=' data-length="',(d=c.length)?d=d.call(a,{hash:{},data:b}):(d=a.length,d=typeof d===s?d.apply(a):d),e+=t(d)+'" maxlength="',(d=c.length)?d=d.call(a,{hash:{},data:b}):(d=a.length,d=typeof d===s?d.apply(a):d),e+=t(d)+'" '}function o(a,b){var d,e,f="";return f+='\n			<h2 class="purchase__h2">',e={hash:{},data:b},f+=t((d=c._||a._,d?d.call(a,"No payment methods for this item :(","purchase",e):v.call(a,"_","No payment methods for this item :(","purchase",e)))+"</h2>\n		"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var p,q,r="",s="function",t=this.escapeExpression,u=this,v=c.helperMissing;return r+='<div class="purchase__cont">\n	<div class="purchase__row">\n		',q=c["if"].call(b,(p=b.invoice,p=null==p||p===!1?p:p.pay_methods,null==p||p===!1?p:p.length),{hash:{},inverse:u.program(14,o,e),fn:u.program(1,f,e),data:e}),(q||0===q)&&(r+=q),r+='\n	</div>\n</div>\n<div class="purchase__fader"></div>'}),this.qst.Templates.ptemplates["misc/request-form"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n<input type="hidden" name="'+j((c=b,c=null==c||c===!1?c:c.key,typeof c===i?c.apply(a):c))+'" value="'+j(typeof a===i?a.apply(a):a)+'">\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+='<form action="',(g=c.submit_url)?g=g.call(b,{hash:{},data:e}):(g=b.submit_url,g=typeof g===i?g.apply(b):g),h+=j(g)+'" method="',(g=c.method)?g=g.call(b,{hash:{},data:e}):(g=b.method,g=typeof g===i?g.apply(b):g),h+=j(g)+'" class="hidden-form">\n',g=c.each.call(b,b.parameters,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+='\n<input type="submit" value="buy">\n</form>'}),this.qst.Templates.ptemplates["pages/403-page"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i=c.helperMissing,j=this.escapeExpression;return h+='<p class="error-page__description">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,'Sorry, can’t let you get any further than this.<br/>Please <a href="auth:show" type="event" class="lnk">log in</a> or <a  href="auth:show" type="event" class="lnk">sign up</a> to see this page.',"p403",g):i.call(b,"_",'Sorry, can’t let you get any further than this.<br/>Please <a href="auth:show" type="event" class="lnk">log in</a> or <a  href="auth:show" type="event" class="lnk">sign up</a> to see this page.',"p403",g)))+"</p>"}),this.qst.Templates.ptemplates["pages/404-page"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i=c.helperMissing,j=this.escapeExpression;return h+='<ul class="error-page__list">\n	<li class="error-page__list-item">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Make sure that URL entered correctly;","p404",g):i.call(b,"_","Make sure that URL entered correctly;","p404",g)))+'</li>\n	<li class="error-page__list-item">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,'or drop us a line to <a href="mailto:support@qstoq.ru" class="lnk">support@qstoq.ru.</a>',"p404",g):i.call(b,"_",'or drop us a line to <a href="mailto:support@qstoq.ru" class="lnk">support@qstoq.ru.</a>',"p404",g)))+"</li>\n</ul>"}),this.qst.Templates.ptemplates["pages/finish-page"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i=c.helperMissing,j=this.escapeExpression;return h+='<table class="finish__table">\n	<tr>\n		<td>\n			<div class="item-receipt__cont"></divv>\n			<ul class="invoice-state__cont">\n				<li class="invoice-state__item invoice-state__0">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"New","finish",g):i.call(b,"_","New","finish",g)))+'</li>\n				<li class="invoice-state__item invoice-state__1">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Processing","finish",g):i.call(b,"_","Processing","finish",g)))+'</li>\n				<li class="invoice-state__item invoice-state__2">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Ok","finish",g):i.call(b,"_","Ok","finish",g)))+'</li>\n				<li class="invoice-state__item invoice-state__3">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Not paid","finish",g):i.call(b,"_","Not paid","finish",g)))+"</li>\n			</ul>\n		</td>\n	</tr>\n</table>\n"}),this.qst.Templates.ptemplates["pages/item-page"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="item__section-row"></div>'}),this.qst.Templates.ptemplates["pages/purchase-page"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="purchase-row"></div>'}),this.qst.Templates.ptemplates["popups/confirm"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<p class="confirm__p">',(f=c.content)?f=f.call(b,{hash:{},data:e}):(f=b.content,f=typeof f===h?f.apply(b):f),g+=i(f)+'</p>\n<ul class="confirm__line">\n	<li class="confirm__ok">',(f=c.ok_title)?f=f.call(b,{hash:{},data:e}):(f=b.ok_title,f=typeof f===h?f.apply(b):f),g+=i(f)+'</li>\n	<li class="confirm__close">',(f=c.close_title)?f=f.call(b,{hash:{},data:e}):(f=b.close_title,f=typeof f===h?f.apply(b):f),g+=i(f)+'</li>\n</ul>\n<p class="confirm__p_success">',(f=c.success_title)?f=f.call(b,{hash:{},data:e}):(f=b.success_title,f=typeof f===h?f.apply(b):f),g+=i(f)+'</p>\n<p class="confirm__p_error">',(f=c.error_title)?f=f.call(b,{hash:{},data:e}):(f=b.error_title,f=typeof f===h?f.apply(b):f),g+=i(f)+"</p>"}),this.qst.Templates.ptemplates["popups/popup"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<table class="popup__table ',(f=c.klass)?f=f.call(b,{hash:{},data:e}):(f=b.klass,f=typeof f===h?f.apply(b):f),g+=i(f)+'" tabindex="-1">\n	<tr>\n		<td class="popup__td">\n			<div class="popup__close">\n				<div class="popup__close-col">\n					<span class="close">&times;</span>\n				</div>\n			</div>\n			<div class="popup__previous">\n				<div class="popup__previous-col">\n					<i class="prev"></i>\n				</div>\n			</div>\n			<div class="popup__inner">\n				<div class="popup__content">\n					<i class="qi qi-popup-close popup__close-btn"></i>\n					',(f=c.content)?f=f.call(b,{hash:{},data:e}):(f=b.content,f=typeof f===h?f.apply(b):f),(f||0===f)&&(g+=f),g+="\n				</div>\n			</div>\n		</td>\n	</tr>\n</table>"}),this.qst.Templates.ptemplates["popups/warning"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h,i="",j=c.helperMissing,k=this.escapeExpression,l="function";return i+='<h1 class="warning__h">',h={hash:{},data:e},i+=k((f=c._||b._,f?f.call(b,"Warning!","warning",h):j.call(b,"_","Warning!","warning",h)))+'</h1>\n<p class="warning__p">',(g=c.content)?g=g.call(b,{hash:{},data:e}):(g=b.content,g=typeof g===l?g.apply(b):g),(g||0===g)&&(i+=g),i+='</p>\n<span class="warning__close">',h={hash:{},data:e},i+=k((f=c._||b._,f?f.call(b,"Ok","warning",h):j.call(b,"_","Ok","warning",h)))+"</span>"}),"undefined"==typeof console&&(this.console={log:function(){},error:function(){}}),window.qst=window.qst||{},window.qst=_.extend(window.qst,{language:_.getCookie("lang")||"ru",root:"http://localhost:3017",l10n:{},preloadTemplates:function(){if(window.qst_dev){var a=[];return _.each(window.templates.files,function(b){var c=window.templates.path+"/"+b+"."+window.templates.ext;a.push($.get(c,function(a){qst.Templates.add(b,a)}))}),a}return[]},init:function(){"en"!==this.language&&"ru"!==this.language&&(this.language="en"),$.when.apply(this,this.preloadTemplates()).done(function(){qst.app=new qst.App({debug:!0}),Backbone.history.start({pushState:!0})}),$(document).on("click","a",function(a){if(a.metaKey||a.ctrlKey)return!0;var b=$(this);return b.attr("target")?!0:(a.stopPropagation(),a.preventDefault(),"event"==b.attr("type")?qst.trigger(b.attr("href")):(qst.app.router.context=b.data(),qst.app.router.navigate(b.attr("href"),{trigger:!0})),!1)})},log:function(a){console.log(a)},error:function(a){console.error(a)},navigate:function(a,b){b&&b.trigger===!1&&(qst.app.statistic.trackCurrentPageChange(),qst.app.trigger("need:meta:update")),qst.app.router.navigate(a,b)},is_authed:function(){return!!qst.user&&qst.user.is_auth()},warning:function(a,b){new qst.WarningView({content:qst.localize(a,b)})},localize:function(a,b){return Handlebars.helpers._(a,b).toString()},speedScrollTop:function(a,b){$("html, body").animate({scrollTop:a||0},b||300)}}),window.qst.Templates=window.qst.Templates||{},window.qst.Templates=_.extend(window.qst.Templates,{templates:{},compiled:{},add:function(a,b){this.templates[a]=b},get:function(a){if(window.qst_dev)return this.compiled[a]?this.templates[a]:this.templates[a]?(this.templates[a]=Handlebars.compile(this.templates[a]),this.compiled[a]=!0,this.templates[a]):(console.error("Can't find template \""+a+'"'),function(){return""});if(this.ptemplates){var b=this.ptemplates[a];return b?b:(console.error("Can't find template \""+a+'"'),function(){return""})}return console.error("Can't find templates at all"),function(){return""}}}),Backbone._sync=Backbone.sync,Backbone.sync=function(a,b,c){c=c||{};var d={lang:qst.language};return c.url=(c.url||b.url&&_.result(b,"url"))+"?"+_.map(d,function(a,b){return b+"="+a}).join("&"),Backbone._sync(a,b,c)},$(document).ready(function(){_.extend(qst,Backbone.Events),qst.init()}),qst.LazyLoader=Backbone.Model.extend({onImageError:function(){this.trigger("load:error")},load:function(a){var b=a.find("img.lazy"),c=this;_.forEach(b,function(a,b){var d=$(a),e=d.data(),f=new Image;f.src=e.orig,f.onload=function(a){if(d.parents(".load-bg").toggleClass("img-loaded",!0),e.scale){var b=this.width,c=this.height,f=e.width,g=e.height,h=b/f,i=c/g;h>i?d.css({width:f,height:"auto"}):d.css({width:"auto",height:g})}if(e.bg){var j={},k="cover",l=0,m=0;if(e.crop){var b=this.width,c=this.height,f=e.width,g=e.height,h=b/f,i=c/g;h>i?(k="cover",l=-Math.round((b/i-f)/2)):i>h&&(k="cover",m=-Math.round((c/h-g)/2)),j={"background-image":"url("+e.orig+")","background-position-x":l,"background-position-y":m,width:f,height:g}}else j={"background-image":"url("+e.orig+")"};d.css(j)}else d.attr("src",e.orig)},f.onerror=_.bind(c.onImageError,c)})}}),qst.Page=Backbone.Model.extend({initialize:function(a){a.template||this.trigger("error",{message:"Page must have a template"}),this.view=new qst.PageView({model:this,template:a.template}),this.view.on("render",function(){this.collection.trigger("render")}),this.get("view")&&(this.get("model")?this.pageView=new(qst[this.get("view")])({model:this.get("model")}):this.pageView=new(qst[this.get("view")])),this.get("model")&&(this.pageModel=new(qst[this.get("model")]))},render:function(){this.view&&this.view.render&&this.view.render()},remove:function(){this.view.remove()},enterDocument:function(){}}),qst.PageView=Backbone.View.extend({el:"#qst-container",template:"",renderedHtml:null,initialize:function(a){return a&&a.template?(this.template=qst.Templates.get(a.template),void this.createDom()):void qst.error("Page must have a template")},createDom:function(){},render:function(){if(this.renderedHtml)this.$el.append(this.renderedHtml);else{var a=$("<div></div>").addClass("page-"+this.model.get("name")).html(this.template(this.model.toJSON()));this.trigger("page:preRender",a),this.$el.html(a)}$("body").attr("class","body__page-"+this.model.get("name")),this.model.enterDocument(),this.trigger("page:render",this.model),this.trigger("enterDocument",this.model)},remove:function(){console.log("page remove"),this.renderedHtml=this.$el.find(".page-"+this.model.get("name")).detach()}}),qst.PagesCollection=Backbone.Collection.extend({initialize:function(a){},getPage:function(a){var b=this.find(function(b){return b.get("name")==a});return b||this.first()},havePage:function(a){return this.any(function(b){return b.get("name")==a})}}),qst.PopupView=Backbone.View.extend({template:"popups/popup",className:"popup",events:{"click .popup__previous":"previous","click .popup__close":"hide","click .popup__close-btn":"hide","click .popup__td":"bgClick"},options:{},defaults:{content:"",klass:"",width:""},_rendered:!1,initialize:function(a){this.template=qst.Templates.get(this.template),_.defaults(this.options,this.defaults),this.on("popup:show",function(){this.trigger("show")},this),this.on("popup:hide",function(){this.trigger("hide")},this)},render:function(){if(this._rendered)return this.$el;var a=this.options.content;return(_.isObject(a)||!a)&&(this.options.content="<div id='placeholder"+this.cid+"'>"),this.$el.append(this.template(this.options)),this.setContent(a),this._rendered=!0,this.$el.on("scroll.popup",function(a){var b=$(a.currentTarget),c=b.find(".popup__table");b.scrollTop()+150>=c.height()-b.height()&&qst.trigger("popupbottom:reached")}),this.$el},lockPage:function(){$("body").css("overflow","hidden")},unlockPage:function(){$("body").css("overflow","auto")},bgClick:function(a){a&&a.target&&"popup__td"==a.target.className&&this.hide()},reactKeypress:function(a){if(27==a.keyCode){var b=$(a.srcElement);b.is(":input")||this.hide()}},showPopup:function(){var a=$(document.body);a.append(this.render()),this.lockPage(),this.trigger("popup:show"),$(document).on("keyup.popup",_.bind(this.reactKeypress,this))},hidePopup:function(){this.$el.off("scroll.popup"),this.$el.detach(),this.trigger("popup:hide"),$(document).off("keyup.popup")},show:function(){this.showPopup()},hide:function(){return this.hidePopup(),this.unlockPage(),!1},previous:function(){this.trigger("previous")},scroll:function(a){this.$el.animate({scrollTop:a},200)},setContent:function(a){a&&(this.options.content=a,this._rendered?this.$el.find(".popup__content").empty().append(a):this.$el.find("#placeholder"+this.cid).replaceWith(a))},setWidth:function(a){a&&(this.options.width=a,this.$el.find(".popup__inner").toggleClass().addClass("popup__inner").addClass("span"+a))}}),qst.WarningView=Backbone.View.extend({template:"popups/warning",className:"warning",events:{"click .warning__close":"close"},options:{content:":("},initialize:function(a){this.options=a,this.template=qst.Templates.get(this.template),this.popup_view=new qst.PopupView({klass:"warning-popup"}),this.popup_view.on("hide",this.clear,this),this.render()},render:function(){return this.$el.append(this.template(this.options)),this.popup_view.setContent(this.$el),this.popup_view.show(),this.$el},close:function(){return this.popup_view.hide(),!1},clear:function(){return this.popup_view.remove(),this.remove(),!1}}),qst.Confirm=Backbone.Model.extend({url:"/",defaults:{url:"/",data:{},method:"post",event:"",eventdata:"",content:"?",ok_title:"Ok",close_title:"Cancel",success_title:"Allset",error_title:"Something went wrong...",backreload:!1},initialize:function(a){a&&a.url&&(this.url=a.url),this.view=new qst.ConfirmView({model:this})},fetch:function(a){return a=a||{},a.type=this.get("method"),a.data=this.get("data"),a.success=_.bind(this.success,this),a.error=_.bind(this.error,this),this.trigger("load:start"),Backbone.Model.prototype.fetch.call(this,a)},success:function(a,b,c){b=_.toJSON(b),b.error?this.trigger("confirm:error"):(this.trigger("confirm:success"),this.get("event")&&(console.log(this.get("event"),this.get("eventdata")),this.get("eventdata")&&!_.isEmpty(_.toJSON(this.get("eventdata")))?qst.trigger(this.get("event"),_.toJSON(this.get("eventdata"))):qst.trigger(this.get("event"))))},error:function(a,b,c){this.trigger("confirm:error")}}),qst.ConfirmView=Backbone.View.extend({template:"popups/confirm",className:"confirm",events:{"click .confirm__close":"close","click .confirm__ok":"confirm"},initialize:function(a){this.template=qst.Templates.get(this.template),this.popup_view=new qst.PopupView({klass:"confirm-popup"}),this.model.on("load:start",this.confirmStart,this),this.model.on("confirm:success",this.confirmSuccess,this),this.model.on("confirm:error",this.confirmError,this),this.popup_view.on("hide",this.clear,this),this.render()},render:function(){return this.$el.append(this.template(this.model.toJSON())),this.popup_view.setContent(this.$el),this.popup_view.show(),this.$el},confirm:function(){return this.model.fetch(),!1},confirmStart:function(){return this.$el.toggleClass("confirm_loading",!0).toggleClass("confirm_success",!1).toggleClass("confirm_error",!1),!1},confirmSuccess:function(){if(this.$el.toggleClass("confirm_loading",!1).toggleClass("confirm_success",!0).toggleClass("confirm_error",!1),this.model.get("backreload")){setTimeout(_.bind(function(){qst.trigger("historyback:reload"),this.clear()},this),1e3)}return!1},confirmError:function(){this.$el.toggleClass("confirm_loading",!1).toggleClass("confirm_success",!1).toggleClass("confirm_error",!0);setTimeout(_.bind(function(){this.$el.toggleClass("confirm_error",!1)},this),2500);return!1},close:function(){return this.popup_view.hide(),!1},clear:function(){return this.popup_view.remove(),
this.remove(),this.model.clear({silent:!0}),!1}}),qst.UserSettings=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/users/",defaults:{geo_position:null},fetch:function(a){return a=a||{},a.type="get",a.data=a.data||{token:_.getCookie("token")},a.success=_.bind(this.success,this),a.error=_.bind(this.error,this),this.trigger("load:start"),Backbone.Model.prototype.fetch.call(this,a)},success:function(a,b,c){var b=_.toJSON(b);b.success&&b.result.user?(this.set(b.result.user),this.trigger("usersettings:ready",b.result.user)):this.trigger("error",{description:"invalid token!"})},error:function(a,b,c){this.trigger("error",{description:"invalid token!"})},getGeoPosition:function(){this.get("geo_position")||(navigator.geolocation?navigator.geolocation.getCurrentPosition(_.bind(this.getGeoSuccess,this),_.bind(this.getGeoError,this)):error("not supported"))},getGeoSuccess:function(a){this.set("geo_position",a)},getGeoError:function(a){qst.error(a)}}),qst.User=Backbone.Model.extend({cookie_time:365,defaults:{status:"",uid:"",token:""},settings:null,initialize:function(){this.settings=new qst.UserSettings,this.settings.on("error",function(a){this.clearSession(),this.trigger("user:error",a)},this),this.on("change:token",function(a){this.settings.fetch()},this),this.getSession(),qst.on("auth:success",this.setSession,this),qst.on("auth:clear",this.clearSession,this)},getSession:function(){var a=_.getCookie("uid"),b=_.getCookie("token");a&&b&&this.set({uid:a,token:b})},is_auth:function(){return!!this.get("token")},setSession:function(a){_.setCookie("uid",a.session.uid,this.cookie_time),_.setCookie("token",a.session.token,this.cookie_time),this.set(a.session)},clearSession:function(){_.clearCookie("uid"),_.clearCookie("token")}}),qst.Registration=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/users/",initialize:function(){},fetch:function(a){var b=this;this.set(a),$.ajax({type:"POST",url:_.toSafeUrl(this.url),dataType:"json",data:{email:a.login,password:a.password,name:a.name}}).success(function(a,c,d){b.success(a,c,d)}).error(function(a,c,d){b.error(a,c,d)})},success:function(a,b,c){var d=_.toJSON(a);d?(this.trigger("auth:success",{response:d.result,user:d.result.user,session:{token:d.result.token,uid:d.result.user.id}}),this.trigger("registration:success")):this.error(null,null,"unknown")},error:function(a,b,c){this.trigger("error",{description:c})}}),qst.Signin=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/auth",initialize:function(){},login:function(a){return this.fetch(a),!1},fetch:function(a){var b=this;$.ajax({type:"post",url:this.url,dataType:"json",data:{email:a.login,password:a.password}}).success(function(a,c,d){b.success(a,c,d)}).error(function(a,c,d){b.error(a,c,d)})},success:function(a,b,c){var d=_.toJSON(a);d?this.trigger("auth:success",{response:d.result,user:d.result.user,session:{token:d.result.token,uid:d.result.user.id}}):this.error(null,null,"unknown")},error:function(a,b,c){if(console.log(a,b,c),a.responseText){var d=_.toJSON(a.responseText);if(d&&d.error)return this.trigger("error",d.error),!0}return this.trigger("error",{}),!0}}),qst.TW=Backbone.Model.extend({url_token:"/api/auth/twitter/request_token/",url:"/api/auth/",inited:!1,req_count:0,req_max:5,curWind:null,loading:!1,oauth_token:0,initialize:function(){var a,b=document.getElementsByTagName("script")[0];document.getElementById("twitter-jssdk")||(a=document.createElement("script"),a.id="twitter-jssdk",$(a).load(function(a){}),a.src="//platform.twitter.com/widgets.js",b.parentNode.insertBefore(a,b),this.inited=!0,this.on("error",function(a){console.error(a)},this),qst.is_authed()||(this.req_count=0,this.fetchToken()))},login:function(){return qst.log("login tw >"),this.loading||(this.curWind=_.openWindow2("Twitter auth",640,480),this.curWind.location.href="http://api.twitter.com/oauth/authorize?oauth_token="+this.oauth_token),!1},fetchToken:function(){this.req_count>this.req_max&&this.trigger("error",{description:"too many token request to "+this.url_token}),this.loading=!0;var a=this;$.ajax({type:"GET",url:_.toSafeUrl(this.url_token),dataType:"json"}).success(function(b,c,d){a.successToken(b,c,d)}).error(function(b,c,d){a.errorToken(b,c,d)})},successToken:function(a,b,c){var d=_.toJSON(a);this.req_count++,d.error?this.trigger("error",{description:"WHP/auth/TW : got error while getting twitter token = ["+d.error.code+"]"}):(this.oauth_token=d.oauth_token,this.loading=!1,qst.log("WHP/auth/TW : get twitter request token = ["+d.oauth_token+"]"),this.req_count=0)},errorToken:function(a,b,c){this.req_count++,this.trigger("error",{description:"WHP/auth/TW : error while logging in!"});var b=a.status;console.log(a),0==b?this.trigger("error",{description:"WHP/auth/TW : OFFLINE mode!"}):this.trigger("error",{description:"WHP/auth/TW : error while getting twitter request token! Status = ["+b+"] Tries = ["+this.req_count+"]"}),this.fetchToken()},fetch:function(a){qst.log("GET TW AUTH = ["+a.uid+" : "+a.token+" : "+a.secret+"]"),qst.log("WHP/auth/TW : get auth...");var b=this;$.ajax({type:"GET",url:_.toSafeUrl(this.url),dataType:"json",data:{social:"tw",access_token:a.token,access_token_secret:a.secret}}).success(function(a,c,d){b.success(a,c,d)}).error(function(a,c,d){b.error(a,c,d)})},success:function(a,b,c){var d=_.toJSON(a);d.error?"API_AuthFailed"==d.error.code?this.trigger("error",{description:"This account isn't linked with WeHeartPics"}):this.trigger("error",{description:"Something went wrong"}):this.trigger("auth:success",{response:d,user:d.user,session:{token:d.user.token,uid:d.user.id}})},error:function(a){this.trigger("error",{description:"WHP/auth/TW : error while logging in!"})}}),qst.VK=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/auth/vk",inited:!1,wind:null,app_id:3836385,redirect_url:qst.root+"/go/close_vk.html",initialize:function(){},login:function(){return this.wind=_.openWindow2("VK auth",640,480),this.wind.location.href="http://oauth.vk.com/authorize?client_id="+this.app_id+"&scope=photos,offline&response_type=token&display=popup&redirect_uri="+this.redirect_url,!1},fetch:function(a){var b=this;$.ajax({type:"post",url:this.url,dataType:"json",data:{vkAccessToken:a.token,vkUserId:a.uid}}).success(function(a,c,d){b.success(a,c,d)}).error(function(a){b.error(a)})},success:function(a,b,c){var d=_.toJSON(a);d&&d.success?this.trigger("auth:success",{response:d.result,user:d.result.user,session:{token:d.result.token,uid:d.result.user.id}}):this.error()},error:function(a){qst.log("WHP/auth/VK : error while logging in!"),this.trigger("error",{description:"Something went wrong"})}}),qst.FB=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/auth/fb",app_id:"137692866413480",inited:!1,access_token:null,access_uid:null,initialize:function(){window.fbAsyncInit=_.bind(function(){FB.init({appId:this.app_id,cookie:!0,status:!0,xfbml:!0,oauth:!1}),FB.Event.subscribe("edge.create",this.fbShareEvents),_.browser.opera&&(FB.XD._transport="postmessage",FB.XD.PostMessage.init()),FB.getLoginStatus(_.bind(function(a){"connected"==a.status?qst.log("Facebook : user was succesfully connected! :)"):qst.log("Facebook : user was not connected! :(")},this))},this),function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js#xfbml=1",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),this.inited=!0},fetch:function(){if(null!=this.access_token){var a=this;$.ajax({type:"post",url:this.url,data:{fbUserId:this.access_uid,fbAccessToken:this.access_token},dataType:"json"}).success(function(b,c,d){a.success(b,c,d)}).error(function(b){a.error(b)})}},success:function(a,b,c){var d=_.toJSON(a);d&&d.success?this.trigger("auth:success",{response:d.result,user:d.result.user,session:{token:d.result.token,uid:d.result.user.id}}):this.error()},error:function(a){qst.log("WHP/auth/FB : error while logging in!"),this.trigger("error",{description:"WHP/auth/FB : error while logging in!"})},login:function(a){return this.access_token="",FB.login(_.bind(this.onFBData,this),{scope:"publish_actions,publish_stream,user_photos,offline_access,email,user_birthday"}),!1},loginOG:function(a,b){this.access_token="",FB.login(b,{scope:"publish_actions,publish_stream,user_photos,offline_access,email,user_birthday"})},fbShareEvents:function(a){qst.log("CreateEdge"),this.trigger("fb:like",a)},onFBData:function(a){if("connected"==a.status){qst.log("Facebook : user was succesfully connected! :)",a.authResponse);var b=a.authResponse.userID,c=a.authResponse.accessToken;this.access_token!=c?(qst.log("Facebook : token = ["+c+"]"),this.access_uid=b,this.access_token=c,this.fetch()):qst.log("Facebook : user was not connected! :(")}}}),qst.Config=function(){return{}},qst.Statistic=Backbone.Model.extend({yaCounter:null,gaCounter:null,initialize:function(){this.active=!_.browser.phantom},trackCurrentPageChange:function(a){return this.active?(this.trackPageChange(window.location.pathname),!0):!1},trackPageChange:function(a){if(!this.active)return!1;var b=a.toString();"/"!=b.charAt(0)&&(b="/"+b),window._gaq&&window._gaq.push(["_trackPageview",b]),window.yaCounter22431070&&window.yaCounter22431070.hit(qst.root+b)},trackRegistration:function(){return this.active?(window._gaq.push(["_trackEvent","User","registration"]),void window.yaCounter22431070.reachGoal("User_registration")):!1},trackProductCreate:function(a){return this.active?(a||(a="unnamed"),window._gaq.push(["_trackEvent","Product","create",a]),void window.yaCounter22431070.reachGoal("Product_create")):!1},trackPSConnect:function(a){return this.active?(a||(a="unnamed"),window._gaq.push(["_trackEvent","PaySystem","connect",a]),void window.yaCounter22431070.reachGoal("PaySystem_connect")):!1},trackProductTryToBuy:function(a){return this.active?(a||(a="unnamed"),window._gaq.push(["_trackEvent","Product","trytobuy",a]),void window.yaCounter22431070.reachGoal("Product_trytobuybuy")):!1},trackProductSold:function(a){return this.active?(a||(a="unnamed"),window._gaq.push(["_trackEvent","Product","sold",a]),void window.yaCounter22431070.reachGoal("Product_sold")):!1}}),qst.App=Backbone.Model.extend({_didScroll:!1,initialize:function(){this.$og_image=$("#og_image"),this.$og_url=$("#og_url");var a=this,b=window.qst;this.statistic=new b.Statistic,this.router=new b.Router,this.pages=new b.PagesCollection,this.user=new b.User,b.user=this.user,b.config=this.config,this.pages.add(new b.Page({name:"404",template:"pages/404-page"})),this.pages.add(new b.Page({name:"403",template:"pages/403-page"})),this.item=new b.ItemPage({name:"item",template:"pages/item-page"}),this.pages.add(this.item),this.purchase=new b.PurchasePage({name:"purchase",template:"pages/purchase-page"}),this.pages.add(this.purchase),this.finish=new b.FinishPage({name:"finish",template:"pages/finish-page"}),this.pages.add(this.finish),this.router.on("404",function(){a.pages.getPage("404").render()}),this.router.on("403",function(){a.pages.getPage("403").render()}),this.router.on("route",function(a,c,d){switch(this.router.route_passed>1&&this.statistic.trackCurrentPageChange(),b.trigger("route",a,c,d),a){case"er404":this.pages.getPage("404").render();break;case"er403":this.pages.getPage("403").render();break;case"item":this.item.render({id:c[0]});break;case"purchase":this.router.route_passed<=1?c[0]?b.navigate("/b"+c[0],{trigger:!0}):b.trigger("403"):this.purchase.render({id:c[0],in_popup:!0});break;case"finish":var e=_.getURLParameter("secret");e?this.finish.render({id:c[0],secret:e}):b.trigger("403");break;default:c[0]&&!this.router.previousWasPopup()}this.trigger("need:meta:update")},this),this.router.on("reset",function(a,c){if(!this.router.isPopup(c))switch(this.router.isPopup(a)||b.speedScrollTop(0,1),a){case"item":console.log("reset:item"),this.item.sleep();break;case"finish":console.log("reset:finish"),this.finish.sleep()}this.router.isPopup(a)&&_.forEach(this.pages.models,function(a,b){a.sleep&&a.get("name")!=c&&a.sleep()})},this),this.on("need:meta:update",function(){this.$og_url.attr("content",window.location.href)},this),b.on("historyback",function(){b.navigate(this.router.back_path,{trigger:!0})},this),b.on("historyback:reload",function(){b.trigger("historyback"),window.location.reload()},this),b.on("404",function(){this.pages.getPage("404").render()},this),b.on("403",function(){this.pages.getPage("403").render()},this),this.on("error",function(a){console.error("error"),a&&a.description&&b.error(a.description)}),this.user.on("user:error",function(a){this.trigger("error",a)},this),this.user.settings.on("usersettings:ready",function(a){b.trigger("usersettings:ready",a)},this);var c=$(window),d=$(document);$(window).scroll(function(){var a=c.scrollTop(),e=d.height(),f=c.height();b.trigger("scroll",{s_top:a,d_h:e,w_h:f}),a+150>=e-f&&b.trigger("pagebottom:reached")}),b.trigger("app:init")}}),qst.Router=Backbone.Router.extend({_previous_route:"",previous_route:"",previous_page_route:"",current_route:"",_back_path:"",back_path:"",route_passed:0,context:{},routes:{"b:id/":"item","b:id":"item","purchase/:id/":"purchase","purchase/:id":"purchase","r/:id/":"finish","r/:id":"finish",404:"er404",403:"er403","*default":"er404"},popoup_routes:["purchase"],item:function(){},er404:function(){return console.log("no such route ",arguments),this.trigger("404",arguments),!1},er403:function(){return console.log("access dinied route ",arguments),this.trigger("403",arguments),!1},initialize:function(){var a=_.uniq(_.values(this.routes));_(a).each(function(a){this.on("route:"+a,function(){this.route_passed++,this._previous_route&&this._previous_route!=a&&(this.trigger("reset",this._previous_route,a,this._back_path),this.trigger("reset:"+this._previous_route)),this._previous_route=a,this._back_path=Backbone.history.fragment},this)},this),this.on("reset",function(a,b,c){this.back_path=c,this.current_route=b,this.previous_route=a,this.isPopup(this.previous_route)||(this.previous_page_route=this.previous_route)})},previousWasPopup:function(){return this.isPopup(this.previous_route)},currentIsPopup:function(){return this.isPopup(this.current_route)},isPopup:function(a){return-1!==_.indexOf(this.popoup_routes,a)}}),qst.Item=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/links/",preview:null,defaults:{preview_obj:"",customer_email:""},initialize:function(a){this.view=new qst.ItemView({model:this}),qst.on("usersettings:ready",this.updateCustomerEmail,this)},init:function(){this.set("url_short_path",this.get("url_short").split("http://")[1]);var a=this.get("preview");if(a&&a.length){var b=_.where(a,{identifier:"preview_image"});b&&b.length&&this.set("preview_obj",b[0])}},fetch:function(a){return a=a||{},a.url=this.url+this.get("id"),a.type="get",a.data=a.data||{},a.success=_.bind(this.success,this),a.error=_.bind(this.error,this),this.trigger("load:start"),Backbone.Model.prototype.fetch.call(this,a)},updateCustomerEmail:function(a){a&&a.email&&this.set("customer_email",a.email)},success:function(a,b,c){b=_.toJSON(b),this.set(b.result),b.success?(this.init(),this.trigger("load:success")):this.trigger("load:error")},error:function(a,b){this.trigger("load:error")},activate:function(){this.set("sleeped",!1)},sleep:function(){this.set("sleeped",!0)}}),qst.ItemView=Backbone.View.extend({template:"blocks/item",template_form:"misc/request-form",className:"item",events:{"click .showcase__share-itm-a":"clickShare","click .showcase__form__buy-btn":"submitForm",keydown:"hideErrors",click:"hideErrors","submit form":"submit"},initialize:function(){this.template=qst.Templates.get(this.template),this.template_form=qst.Templates.get(this.template_form),this.model.on("load:success",this.render,this),this.model.on("change:sleeped",this.sleep,this),this.model.on("change:url",this.changeLink,this),this.model.on("change:customer_email",this.changeCustomerEmail,this),this.lazy_loader=new qst.LazyLoader},render:function(){var a=this.template(this.model.toJSON());this.$el.html(a),this.$form=this.$el.find("form"),this.$error=this.$el.find(".item__error"),this.$input_email=this.$el.find("[name=customer_email]"),this.lazy_loader.load(this.$el),this.delegateEvents(),$("title").text("Qstoq - "+this.model.get("name")),$("#og_title").attr("content","Qstoq - "+this.model.get("name")),$("#og_url").attr("content",this.model.get("url_short")),this.model.get("preview_obj")&&this.model.get("preview_obj").data&&$("#og_image").attr("content",this.model.get("preview_obj").data),this.model.get("description")&&($("meta[name=description]").attr("content",this.model.get("description")),$("#og_description").attr("content",this.model.get("description")))},submit:function(a){if(!this.model.get("active"))return this.showError(qst.localize("Link inactive","item")),!1;var b=$.trim(this.$input_email.val());return _.isEmail(b)?b.length>50?this.showError(qst.localize("Too much","item"),"email"):(this.model.set({customer_email:b}),qst.navigate("/purchase/"+this.model.get("id"),{trigger:!0})):this.showError(qst.localize("Doesn&#39;t look like a valid email","item"),"email"),!1},changeCustomerEmail:function(a,b){this.$input_email&&b&&this.$input_email.val(b)},showError:function(a,b){switch(this.$error.html(a),this.$el.toggleClass("error",!0),b){case"email":this.$input_email.parents(".qst__inp-cont").toggleClass("error-inp",!0),this.$input_email.focus()}},hideErrors:function(){this.$el.toggleClass("error",!1),this.$el.find(".error-inp").toggleClass("error-inp",!1)},submitForm:function(){return this.$form.submit(),!1},clickShare:function(a){var b=$(a.currentTarget).attr("href"),c=(encodeURIComponent(this.model.get("description")),this.model.get("url_short")),d="",e=this.model.get("preview_obj")?this.model.get("preview_obj").data:"http://qstoq.ru/images_static/fav144.png";return"facebook"===b?(d="https://www.facebook.com/dialog/feed?",d+="link="+encodeURIComponent(c)+"&redirect_uri="+encodeURIComponent(c)+"&display=popup&app_id=137692866413480&caption="+encodeURIComponent(this.model.get("name"))+"&picture="+e+"&description="+encodeURIComponent(this.model.get("description"))):(d="vk"===b?"http://vkontakte.ru/share.php?noparse=true&":"http://api.addthis.com/oexchange/0.8/forward/"+b+"/offer?",d+="url="+encodeURIComponent(c)+"&title="+encodeURIComponent(this.model.get("name"))+"&description="+encodeURIComponent(this.model.get("description"))+"&pubid=prolll&text="+encodeURIComponent(this.model.get("description"))+"&via=qstoq&screenshot="+e+"&image="+e),_.openWindow3(d,b,480,360),!1},clear:function(){this.hideErrors()},sleep:function(a,b,c){b?(this.undelegateEvents(),this.clear()):this.delegateEvents()}}),qst.ItemPage=qst.Page.extend({visited:!1,defaults:{id:0,sleeped:!0},url:"",initialize:function(a){a=a||{}},needRerender:function(a){return this.get("sleeped")||a.id!=this.get("id")},render:function(a){return this.set(a),this.needRerender(a)?void(this.visited?(this.view.render(),this.item.set(a),this.item.fetch(),this.item.activate(),this.view.addItem(this.item),this.set("sleeped",!1)):(this.visited=!0,this.view=new qst.ItemPageView({model:this,template:"pages/item-page"}),this.view.render(),this.item=new qst.Item(a),this.item.fetch(),this.item.activate(),this.view.addItem(this.item),this.item.on("load:error",this.error,this),this.set("sleeped",!1))):!1},sleep:function(){return this.get("sleeped")?!1:(this.set("sleeped",!0),void(this.item&&this.item.sleep()))},error:function(){qst.trigger("404")}}),qst.ItemPageView=qst.PageView.extend({addItem:function(a){this.$el.find(".item__section-row").html(a.view.$el)}}),qst.Purchase=Backbone.Model.extend({url_invoice:"http://api.qstoq.ru/v1/invoices/",url_purchase:"http://api.qstoq.ru/v1/purchases/",defaults:{},initialize:function(a){this.view=new qst.PurchaseView({model:this})},activate:function(a){this.set("sleeped",!1),this.set(a),this.invoice()},invoice:function(a){var b=this.toJSON();return a=a||{},a.url=this.url_invoice,a.type="post",a.data=a.data||{amount:b.price,currency:b.currency,link_id:b.id,buyer_email:b.customer_email},a.success=_.bind(this.invoiceSuccess,this),a.error=_.bind(this.invoiceError,this),this.trigger("invoice:start"),Backbone.Model.prototype.fetch.call(this,a)},invoiceSuccess:function(a,b,c){b=_.toJSON(b),this.set({invoice:b.result,invoice_id:b.result.id});var d=b.result.pay_methods,e=[];_.map(d,function(a,b){e.push(a.category_id)}),e=_.unique(e),e=_.map(e,function(a){var b="",c={id:a,methods:_.filter(d,function(c){return c.category_id===a?(b=c.category,!0):!1})};return c.name=b,c}),this.get("invoice").pay_categories=e,this.trigger("invoice:success")},invoiceError:function(a,b,c){if(b.responseText){var d=_.toJSON(b.responseText);if(d&&d.error)return this.trigger("invoice:error",d.error),!0}return this.trigger("invoice:error",{}),!0},purchase:function(a){var b=(this.toJSON(),{});return b.url=this.url_purchase,b.type="post",b.data=_.extend(a,{invoice_id:this.get("invoice_id")}),qst.app.statistic.trackProductTryToBuy(a.method_id),b.success=_.bind(this.purchaseSuccess,this),b.error=_.bind(this.purchaseError,this),this.trigger("purchase:start"),Backbone.Model.prototype.fetch.call(this,b)},purchaseSuccess:function(a,b,c){b=_.toJSON(b),this.trigger("purchase:success"),this.view.requestForm(b.result)},purchaseError:function(a,b,c){if(b.responseText){var d=_.toJSON(b.responseText);if(d&&d.error)return this.trigger("purchase:error",d.error),!0}return this.trigger("purchase:error",{}),!0},sleep:function(){this.set("sleeped",!0)},remove:function(){}}),qst.PurchaseView=Backbone.View.extend({template:"blocks/purchase",template_form:"misc/request-form",className:"purchase",events:{"click .purchase__category-item-a":"chooseGroup","click .purchase__method-item-a":"purchase","submit .purchase__method-item-misc-form":"purchaseMisc","keypress .purchase__method-item-misc-form input":"validateMiscInput"},initialize:function(){this.template=qst.Templates.get(this.template),this.template_form=qst.Templates.get(this.template_form),this.model.on("invoice:start",this.toggleLoadingOn,this),this.model.on("invoice:success",this.render,this),this.model.on("invoice:error",this.error,this),this.model.on("change:sleeped",this.sleep,this),this.model.on("purchase:start",this.toggleLoadingOn,this),this.model.on("purchase:error",this.error,this)},render:function(){this.toggleLoadingOff();var a=this.template(this.model.toJSON());this.$el.html(a),this.$categories=this.$el.find(".purchase__category-item-a"),this.$category_groups=this.$el.find(".purchase__method-list"),this.delegateEvents(),1===this.$categories.length&&this.$categories.eq(0).click()},chooseGroup:function(a){this.$categories.toggleClass("active",!1),this.$el.parents(".popup__inner").toggleClass("open",!0);var b=$(a.currentTarget);b.toggleClass("active",!0),this.$category_groups.toggleClass("active",!1),this.$category_groups.filter(".purchase__method-list-"+b.attr("href")).toggleClass("active",!0)},purchase:function(a){var b=$(a.currentTarget),c=b.data();return c.misc?this.showMiscParams(a):this.model.purchase({method_id:c.methodid}),a.preventDefault(),a.stopPropagation(),!1},showMiscParams:function(a){var b=$(a.currentTarget),c=b.parents(".purchase__method-item");c.toggleClass("active-item",!0),setTimeout(function(){c.find("input").eq(0).focus()},500)},purchaseMisc:function(a){for(var b=$(a.currentTarget),c=$(a.currentTarget).find(":input"),d="",e={},f=!0,g={},h=0;h<c.length;h++)if(d=c.eq(h),e=d.data(),!_.isEmpty(e))if(e.name){if(e.length){if(d.val().length===e.length){g[e.name]=d.val();continue}d.focus().select(),d.toggleClass("error",!0),f=!1;break}g[e.name]=d.val()}else;if(f){var i=b.parents(".purchase__method-item").find(".purchase__method-item-a"),j=i.data();g=_.extend(g,{method_id:j.methodid}),this.model.purchase(g)}return a.preventDefault(),a.stopPropagation(),!1},validateMiscInput:function(a){var b=$(a.currentTarget),c=b.data();return b.toggleClass("error",!1),c.type&&("phone"===c.type||"number"===c.type)?a&&(a.keyCode>47&&a.keyCode<58||13===a.keyCode)?!0:!1:!0},error:function(a){this.toggleLoadingOff(),qst.warning("Something went wrong...","misc")},toggleLoadingOn:function(){this.$el.toggleClass("loading",!0)},toggleLoadingOff:function(){this.$el.toggleClass("loading",!1)},clear:function(){},sleep:function(a,b,c){b?(this.undelegateEvents(),this.clear()):this.delegateEvents()},requestForm:function(a){var b=this.template_form(a),c=$(b);$("body").append(c),c.submit()}}),qst.PurchasePage=Backbone.Model.extend({visited:!1,defaults:{in_popup:!0,id:0},initialize:function(a){},render:function(a){this.set(a),this.visited=!0,a.in_popup=!!a.in_popup,this.view=new qst.PurchasePageView({model:this,template:"pages/purchase-page"}),this.view.render(a.in_popup,!1),this.purchase=new qst.Purchase(a),this.view.addPurchase(this.purchase);var b=qst.app.item.item.toJSON();this.purchase.activate({id:this.get("id"),customer_email:b.customer_email,currency:b.currency,price:b.price})},sleep:function(){this.remove()},remove:function(){this.off(),this.purchase&&(this.purchase.off(),this.purchase.remove()),this.view&&(this.view.off(),this.view.remove())}}),qst.PurchasePageView=qst.PageView.extend({template:"pages/purchase-page",el:"body",is_popup:!1,addPurchase:function(a){this.$el.find(".purchase-row").html(a.view.$el)},render:function(a,b){if(this.is_popup=a,this.popup_view=new qst.PopupView({klass:"purchase-popup"}),this.popup_view.on("hide",function(){qst.trigger("historyback")},this),a)this.setElement("body"),this.renderedHtml?this.popup_view.setContent($(this.renderedHtml)):(this.renderedHtml=this.template(this.model.toJSON()),this.popup_view.setContent($(this.renderedHtml))),this.popup_view.show(),this.popup_view.$el.focus();else if(this.setElement("#qst-container"),this.renderedHtml)this.$el.append(this.renderedHtml);else{this.renderedHtml=this.template(this.model.toJSON());var c=$("<div></div>").addClass("page-"+this.model.get("name")).html(this.renderedHtml);this.trigger("page:preRender",c),this.$el.html(c)}this.trigger("page:render",this.model),this.trigger("enterDocument",this.model),this.delegateEvents()},remove:function(){this.model.off(null,null,this),this.undelegateEvents(),this.popup_view.unlockPage(),this.popup_view.remove()}}),qst.ItemReceiptHolder=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/invoices/",inter:0,defaults:{id:0,secret:0,state:-1,receipt:{}},initialize:function(a){},fetch:function(){var a={};return a.url=this.url+this.get("id"),a.type="get",a.data=a.data||{secret:this.get("secret")},a.success=_.bind(this.success,this),a.error=_.bind(this.error,this),this.trigger("load:start"),Backbone.Model.prototype.fetch.call(this,a)},success:function(a,b,c){if(b=_.toJSON(b),b.success){var d=b.result.state;if(this.set({state:d}),0==d||1==d)this.delaidFetch();else if(3==d);else if(2==d){var e=b.result.link;if(e){var f=!1;_.forEach(e.preview,function(a,b){"receipt_comment"===a.identifier&&(f=a)}),opts={link_id:this.get("id"),active:e.active,name:e.name,description:e.description,url:e.url,external:e.external,url_short:e.url_short,price:e.price,price_pwyw:e.price_pwyw,currency:e.currency,ship_limit:e.ship_limit},f&&f.data&&(opts.receipt_comment=f.data,opts.receipt_comment_id=f.id),this.set({receipt:opts}),qst.app.statistic.trackProductSold(e.name),this.trigger("load:success",opts)}else this.trigger("load:error")}else this.trigger("load:error")}else this.trigger("load:error")},delaidFetch:function(){clearInterval(this.inter),this.inter=setTimeout(_.bind(this.fetch,this),8e3)},error:function(a,b,c){this.trigger("load:error")},sleep:function(){this.set("sleeped",!0)}}),qst.ItemReceipt=Backbone.Model.extend({url:"http://api.qstoq.ru/v1/medias/",defaults:{receipt_comment_id:0,receipt_comment:"",amount:100,link_id:0,name:"name",currency:"rur",description:"desc",url_short:"http://s.qstoq.ru/b842",url:"http://wikimart.ru",external:1,price:0,price_pwyw:0,ship_limit:0},initialize:function(a){this.view=new qst.ItemReceiptView({model:this}),this.on("change:receipt_comment",this.saveReceipt,this)},saveReceipt:function(a,b){this.toJSON();return options={},$.trim(b)?(options.url=this.url+"?identifier=receipt_comment&link_id="+this.get("link_id"),options.type="post",options.data=options.data||{data:b}):(options.url=this.url+this.get("receipt_comment_id"),options.type="delete",options.data={}),options.success=_.bind(this.saveReceiptSuccess,this),options.error=_.bind(this.saveReceiptError,this),this.trigger("savereceipt:start"),Backbone.Model.prototype.fetch.call(this,options)},saveReceiptSuccess:function(a,b,c){b=_.toJSON(b),b.success?(b.result&&b.result.id&&this.set("receipt_comment_id",b.result.id),this.trigger("savereceipt:success")):this.trigger("savereceipt:error")},saveReceiptError:function(a,b,c){this.trigger("savereceipt:error")},activate:function(){this.set("sleeped",!1)},sleep:function(){this.set("sleeped",!0)}}),qst.ItemReceiptView=Backbone.View.extend({template:"blocks/item-receipt",className:"item-receipt",events:{"click .receipt__share-itm-a":"clickShare","click .receipt__form-add-comment-a":"toggleOnReceiptComment","click .receipt__form-receipt_desc-action_cancel>a":"cancelReceiptComment","click .receipt__form-receipt_desc-action_save>a":"saveReceiptComment"},initialize:function(){this.template=qst.Templates.get(this.template),this.model.on("change",this.render,this),this.model.on("change:sleeped",this.sleep,this),this.render()},render:function(){var a=this.template(this.model.toJSON());this.$el.html(a),this.$receipt_comment=this.$el.find(".receipt__form-desc"),this.$input_receipt_comment=this.$el.find(".receipt__form-receipt_desc");var b=$.trim(this.model.get("receipt_comment"));b?this.$el.toggleClass("comment-editing",!1).toggleClass("comment-can-edit",!0).toggleClass("comment-can-add",!1):this.$el.toggleClass("comment-editing",!1).toggleClass("comment-can-edit",!1).toggleClass("comment-can-add",!0),this.delegateEvents()},clickShare:function(a){var b=$(a.currentTarget).attr("href"),c=(encodeURIComponent(this.model.get("description")),this.model.get("url_short")),d="",e=this.model.get("preview_obj")?this.model.get("preview_obj").data:"http://qstoq.ru/images_static/fav144.png";return"facebook"===b?(d="https://www.facebook.com/dialog/feed?",d+="link="+encodeURIComponent(c)+"&redirect_uri="+encodeURIComponent(c)+"&display=popup&app_id=137692866413480&caption="+encodeURIComponent(this.model.get("name"))+"&picture="+e+"&description="+encodeURIComponent(this.model.get("description"))):(d="vk"===b?"http://vkontakte.ru/share.php?noparse=true&":"http://api.addthis.com/oexchange/0.8/forward/"+b+"/offer?",d+="url="+encodeURIComponent(c)+"&title="+encodeURIComponent(this.model.get("name"))+"&description="+encodeURIComponent(this.model.get("description"))+"&pubid=prolll&text="+encodeURIComponent(this.model.get("description"))+"&via=qstoq&screenshot="+e+"&image="+e),_.openWindow3(d,b,480,360),!1},toggleOnReceiptComment:function(a){return this.$el.toggleClass("comment-editing",!0).toggleClass("comment-can-edit",!1).toggleClass("comment-can-add",!1),this.$input_receipt_comment.focus(),!1},toggleOffReceiptComment:function(a){var b=$.trim(this.model.get("receipt_comment"));return b?this.$el.toggleClass("comment-editing",!1).toggleClass("comment-can-edit",!0).toggleClass("comment-can-add",!1):this.$el.toggleClass("comment-editing",!1).toggleClass("comment-can-edit",!1).toggleClass("comment-can-add",!0),!1},cancelReceiptComment:function(a){return this.$input_receipt_comment.val(this.model.get("receipt_comment")),this.toggleOffReceiptComment(),!1},saveReceiptComment:function(a){var b=$.trim(this.$input_receipt_comment.val());return this.model.set("receipt_comment",b),this.$receipt_comment.text(b),this.toggleOffReceiptComment(),!1},sleep:function(a,b,c){b?this.undelegateEvents():this.delegateEvents()}}),qst.FinishPage=qst.Page.extend({visited:!1,itemreceiptholder:null,itemreceipt:null,defaults:{id:0,secret:0,sleeped:!0},initialize:function(a){a=a||{}},needRerender:function(a){return this.get("sleeped")||a.id!=this.get("id")},render:function(a){return this.set(a),this.needRerender(a)?void(this.visited?(this.view.render(),
this.itemreceiptholder.set(a),this.itemreceiptholder.fetch(),this.set("sleeped",!1)):(this.visited=!0,this.view=new qst.FinishPageView({model:this,template:"pages/finish-page"}),this.view.render(),this.itemreceiptholder=new qst.ItemReceiptHolder(a),this.itemreceiptholder.on("load:success",this.renderReceipt,this),this.itemreceiptholder.on("load:error",this.error,this),this.itemreceiptholder.fetch(),this.itemreceiptholder.on("change:state",this.view.describeState,this.view),this.set("sleeped",!1))):!1},renderReceipt:function(a){this.itemreceipt?(this.itemreceipt.set(a),this.itemreceipt.activate(),this.view.addItemReceipt(this.itemreceipt)):(this.itemreceipt=new qst.ItemReceipt(a),this.itemreceipt.activate(),this.view.addItemReceipt(this.itemreceipt))},sleep:function(){return this.get("sleeped")?!1:(this.set("sleeped",!0),this.itemreceiptholder&&this.itemreceiptholder.sleep(),void(this.itemreceipt&&this.itemreceipt.sleep()))},error:function(){qst.trigger("404")}}),qst.FinishPageView=qst.PageView.extend({addItemReceipt:function(a){this.$el.find(".item-receipt__cont").html(a.view.$el)},describeState:function(a,b){this.$el.toggleClass("state0",!1).toggleClass("state1",!1).toggleClass("state2",!1).toggleClass("state3",!1).toggleClass("state"+b,!0)}}),qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.plural={processors:{en:function(a,b){var c=_.toJSON(b.toString());return 1==a?c[0]:c[1]},ru:function(a,b){var c=_.toJSON(b.toString());return a%10==1&&a%100!=11?c[0]:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?c[1]:c[2]},ko:function(a,b){var c=_.toJSON(b.toString());return c[0]},ja:function(a,b){var c=_.toJSON(b.toString());return c[0]},zh:function(a,b){var c=_.toJSON(b.toString());return c[0]}},item:{en:'["item", "items"]',ru:'["товар", "товара", "товаров"]'}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.item={Share:{en:"Share",ru:"Рассказать друзьям"},"Safe payment":{en:"Safe payment",ru:"Платеж безопасен"},No:{en:"No",ru:"Нет"},"Doesn&#39;t look like a valid email":{en:"Doesn&#39;t look like a valid email",ru:"Неправильный формат email"},"Too much":{en:"Too much",ru:"Слишком длинный адрес email"},"Link inactive":{en:"Purchase inactive",ru:"Покупка недоступна"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.itemreceipt={"Add your<br/>message on the receipt":{en:"Add your<br/>message on the receipt",ru:"Добавить ваше<br/>сообщение на чеке"},"Edit your message on the receipt":{en:"Edit your message on the receipt",ru:"Редактировать ваше сообщение на чеке"},Purchased:{en:"Purchased",ru:"Оплачено:"},"Get link":{en:"Get link",ru:"Получить ссылку"},"Get file":{en:"Get file",ru:"Получить файл"},Save:{en:"Save",ru:"Сохранить"},Cancel:{en:"Cancel",ru:"Отменить"},"All purchasement info we&#39;ve sent to your email":{en:"All purchasement info we&#39;ve sent to your email",ru:"Всю информацию о покупке<br/>мы отправили на вашу почту"},"selling in lightning speed":{en:"creating price tags and billing payments for your content or reallife goods and services",ru:"создание виртуальных ценников и прием платежей за ваш контент или реальные товары и услуги"},Share:{en:"Share",ru:" Рассказать друзьям"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.finish={New:{en:"Processing the payment",ru:"Обрабатываем платеж"},Processing:{en:"Processing the payment. Wait a little...",ru:"Обрабатываем платеж. Подождите немного..."},Ok:{en:"Ok. Woohoo...",ru:"Ок. Вухуууу..."},"Not paid":{en:'Payment isn\'t processed. If this text scared you, please, drop us a line to <a href="mailto:support@qstoq.ru?payment" target="mail" class="lnk">support@qstoq.ru.</a>',ru:'Оплата не прошла. Вероятно это не то что, вы ожидали здесь увидеть. Напишите нам на <a href="mailto:support@qstoq.ru?payment" target="mail" class="lnk">support@qstoq.ru</a> — разберемся'}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.itemedit={Main:{en:"Main",ru:"Основное"},Showcase:{en:"Showcase",ru:"Витрина"},"Purchase finish":{en:"Purchase finish",ru:"Завершение покупки"},Customers:{en:"Customers",ru:"Покупатели"},"Available or purchase":{en:"Available or purchase",ru:"Доступно к покупке"},Descrition:{en:"Descrition",ru:"Описание"},"Clicking on that link your customers will get a purchase screen":{en:"Clicking on that link your customers will get a purchase screen",ru:"Перейдя по этой ссылке ваши пользователи откроют окно оплаты."},"Spread the word on your site, on blog or social networks":{en:"Spread the word on your site, on blog or social networks",ru:"Размещайте ссылку на вашем сайте, в блоге, в личных сообщениях или социальных сетях:"},Save:{en:"Save",ru:"Сохранить изменения"},"Remove link":{en:"Remove link",ru:"Удалить"},"Link for purchasing:":{en:"Link for purchasing:",ru:"Ссылка для оплаты:"},"Share on Vkontakte":{en:"Share on Vkontakte",ru:"Опубликовать Вконтакте"},"Share on Facebook":{en:"Share on Facebook",ru:"Опубликовать на Фейсбук"},"Share on Twitter":{en:"Share on Twitter",ru:"Опубликовать в Твиттер"},email:{en:"email",ru:"электронная почта"},"for notifications about your purchases<br/>and feedback":{en:"for notifications about your purchases<br/>and feedback",ru:"для уведомлений о ваших покупках<br/>и обратной связи"},Buy:{en:"Buy",ru:"Купить"},"selling in lightning speed":{en:"creating price tags and billing payments for your content or reallife goods and services",ru:"создание виртуальных ценников и прием платежей за ваш контент или реальные товары и услуги"},"It is a preview of the purchase page your customers will see":{en:"It is a preview of the purchase page your customers will see",ru:"Таким будет экран покупки для ваших покупателей"},"Your message on the receipt":{en:"Your message on the receipt",ru:"Ваше сообщение на чеке"},"It is a receipt your customers will see":{en:"It is a receipt your customers will see",ru:"Таким будет финальный экран для ваших покупателей"},"Coming soon. The list of your buyer will help you to stay close to your customers":{en:"Coming soon. The list of your buyer will help you to stay close to your customers",ru:"Скоро. Здесь будет список ваших покупателей"},"Link for purchase":{en:"Link for purchase",ru:"Ссылка для оплаты"},Cancel:{en:"Cancel",ru:"Отменить"},Save:{en:"Save",ru:"Сохранить"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.purchase={"Choose a payment method":{en:"Choose a payment method",ru:"Выберите способ оплаты"},"No payment methods for this item :(":{en:"No payment methods for this item :(",ru:"Не доступно ни одного метода оплаты :("},Next:{en:"Next",ru:"Продолжить"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.time={m:{en:"m",ru:"м",ko:"분",ja:"分",zh:"分钟"},h:{en:"h",ru:"ч",ko:"시간",ja:"時間",zh:"小时"},d:{en:"d",ru:"дн",ko:"일",ja:"日",zh:"天"},y:{en:"y",ru:"г",ko:"년",ja:"年",zh:"年"},"long time":{en:"long time",ru:"давным давно",ko:"오래",ja:"ずっと",zh:"长时间"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.misc={by:{en:"by",ru:" "},"Something went wrong...":{en:"Something went wrong...",ru:"Что-то пошло не так…"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.currency={RUB:{en:"rub",ru:"р."},rur:{en:"rur",ru:"р."},USD:{en:"$",ru:"$"},EUR:{en:"eur",ru:"евро"},BTC:{en:"BTC",ru:"BTC"},Ruble:{en:"Ruble",ru:"Рубль"},"US Dollar":{en:"US Dollar",ru:"Доллар США"},Euro:{en:"Euro",ru:"Евро"},Bitcoin:{en:"Bitcoin",ru:"Биткойн"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.warning={"Warning!":{en:"Warning!",ru:"Предупреждение!",ko:"경고!",ja:"ご注意！",zh:"警告！"},Ok:{en:"Ok",ru:"Ок",ko:"오케이",ja:"OK",zh:"确定"}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.p404={"Make sure that URL entered correctly;":{en:"Make sure that URL entered correctly;",ru:"Убедитесь, что ссылка введена правильно;",ko:"URL을 정확히 입력하세요;",ja:"正確にURLが入力されたか確認して下さい",zh:"请输入正确的URL"},'or drop us a line to <a href="mailto:support@qstoq.ru" class="lnk">support@qstoq.ru.</a>':{en:'or drop us a line to <a href="mailto:support@qstoq.ru" target="mail" class="lnk">support@qstoq.ru.</a>',ru:'Или напишите нам — <a href="mailto:support@qstoq.ru" target="mail" class="lnk">support@qstoq.ru</a>',ko:'또는 여기로 메시지를 보내주세요 <a href="mailto:support@qstoq.ru" target="mail" class="lnk">support@qstoq.ru</a>',ja:'もしくは<a href="mailto:support@qstoq.ru" target="mail" class="lnk">support@qstoq.ru.</a>にメッセージを送信して下さい。',zh:'或者给我们写信 <a href="mailto:support@qstoq.ru" target="mail" class="lnk">support@qstoq.ru.</a>'}},qst=qst||{},qst.l10n=qst.l10n||{},qst.l10n.p403={'Sorry, can’t let you get any further than this.<br/>Please <a href="auth:show" type="event" class="lnk">log in</a> or <a  href="auth:show" type="event" class="lnk">sign up</a> to see this page.':{en:'Sorry, can’t let you get any further than this.<br/>Please <a href="auth:show" type="event" class="lnk">log in</a> or <a  href="auth:show" type="event" class="lnk">sign up</a> to see this page.',ru:'Мы сейчас не можем показать вам эту страницу.<br/>Чтобы увидеть страницу, вам нужно <a href="auth:show" type="event" class="lnk">Авторизоваться</a> или <a  href="auth:show" type="event" class="lnk">Зарегистрироваться</a>.',ko:'죄송해요, 더는 접근이 불가능하네요. <br/><a href="auth:show" type="event" class="lnk">로그인나</a> <a  href="auth:show" type="event" class="lnk">가입하기</a> 주세요.',ja:'すみません、これ以上アクセスはできません。<br/><a href="auth:show" type="event" class="lnk">ログイン</a>か<a  href="auth:show" type="event" class="lnk">サインアップ</a>下さい',zh:'对不起，你不能再继续前进了。请<a href="auth:show" type="event" class="lnk">登录</a>或者<a  href="auth:show" type="event" class="lnk">注册</a>。'}};